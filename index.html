<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizHisab Pro - Smart Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #4285F4; --success: #34A853; --danger: #EA4335; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 15px; padding-bottom: 50px; }
        .card { background: white; padding: 18px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 15px; }
        
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .summary-card { padding: 15px; border-radius: 12px; text-align: center; color: white; }
        .month-card { background: linear-gradient(135deg, #4285F4, #2b6cb0); }
        .year-card { background: linear-gradient(135deg, #34A853, #22543d); }
        .summary-value { font-size: 1.3rem; font-weight: bold; margin-top: 5px; }

        h3 { margin-top: 0; font-size: 1.1rem; color: #1e293b; border-bottom: 2px solid #f1f5f9; padding-bottom: 8px; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-export { background: #6c757d; margin-bottom: 15px; }
        
        /* Table Styles with Action Buttons */
        .history-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .history-table th, td { padding: 10px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        .actions { display: flex; gap: 8px; }
        .btn-edit { color: #4285F4; cursor: pointer; font-weight: bold; background: none; width: auto; padding: 0; margin: 0; border: none; }
        .btn-delete { color: var(--danger); cursor: pointer; font-weight: bold; background: none; width: auto; padding: 0; margin: 0; border: none; }
    </style>
</head>
<body>

    <div class="summary-grid">
        <div class="summary-card month-card">
            <div id="monthLabel" style="font-size: 0.8rem; opacity: 0.9;">‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á</div>
            <div class="summary-value" id="monthTotal">‚Çπ0</div>
        </div>
        <div class="summary-card year-card">
            <div id="yearLabel" style="font-size: 0.8rem; opacity: 0.9;">‡§á‡§∏ ‡§∏‡§æ‡§≤</div>
            <div class="summary-value" id="yearTotal">‚Çπ0</div>
        </div>
    </div>

    <div class="card">
        <h3 id="formTitle">üí∞ ‡§®‡§Ø‡§æ ‡§ñ‡§∞‡•ç‡§ö‡§æ ‡§ú‡•ã‡•ú‡•á‡§Ç</h3>
        <input type="text" id="desc" placeholder="‡§ñ‡§∞‡•ç‡§ö‡•á ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£">
        <input type="number" id="amt" placeholder="‡§∞‡§ï‡§Æ (‚Çπ)">
        <input type="text" id="cat" placeholder="‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä" list="cat-list">
        <datalist id="cat-list"></datalist>
        <button onclick="saveData()" id="saveBtn">‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <div class="card">
        <h3>üìä ‡§ö‡§æ‡§∞‡•ç‡§ü</h3>
        <canvas id="expenseChart" style="max-height: 200px;"></canvas>
    </div>

    <div class="card">
        <h3>üìú ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä</h3>
        <button class="btn-export" onclick="exportToCSV()">Excel (CSV) ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>
        <div style="overflow-x:auto;">
            <table class="history-table">
                <thead>
                    <tr><th>‡§µ‡§ø‡§µ‡§∞‡§£</th><th>‡§∞‡§ï‡§Æ</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

<script>
    let db = JSON.parse(localStorage.getItem('biz_india_final_v5')) || [];
    let editIndex = -1; // -1 ‡§Æ‡§§‡§≤‡§¨ ‡§®‡§Ø‡§æ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°, >=0 ‡§Æ‡§§‡§≤‡§¨ ‡§è‡§°‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à

    window.onload = () => { updateDisplay(); setupLabels(); };

    function setupLabels() {
        const now = new Date();
        const months = ["‡§ú‡§®‡§µ‡§∞‡•Ä", "‡§´‡§∞‡§µ‡§∞‡•Ä", "‡§Æ‡§æ‡§∞‡•ç‡§ö", "‡§Ö‡§™‡•ç‡§∞‡•à‡§≤", "‡§Æ‡§à", "‡§ú‡•Ç‡§®", "‡§ú‡•Å‡§≤‡§æ‡§à", "‡§Ö‡§ó‡§∏‡•ç‡§§", "‡§∏‡§ø‡§§‡§Ç‡§¨‡§∞", "‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞", "‡§®‡§µ‡§Ç‡§¨‡§∞", "‡§¶‡§ø‡§∏‡§Ç‡§¨‡§∞"];
        document.getElementById('monthLabel').innerText = `‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á (${months[now.getMonth()]})`;
        document.getElementById('yearLabel').innerText = `‡§á‡§∏ ‡§∏‡§æ‡§≤ (${now.getFullYear()})`;
    }

    function saveData() {
        const desc = document.getElementById('desc').value;
        const amt = parseFloat(document.getElementById('amt').value);
        const cat = document.getElementById('cat').value || "Other";
        const now = new Date();

        if(!desc || isNaN(amt)) return alert("‡§µ‡§ø‡§µ‡§∞‡§£ ‡§î‡§∞ ‡§∞‡§ï‡§Æ ‡§≠‡§∞‡•á‡§Ç!");

        const entry = { 
            date: now.toLocaleDateString('en-IN'), 
            month: now.getMonth(), 
            year: now.getFullYear(),
            desc, amt, cat 
        };

        if(editIndex === -1) {
            db.push(entry);
        } else {
            db[editIndex] = entry; // ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•ã ‡§®‡§è ‡§°‡•á‡§ü‡§æ ‡§∏‡•á ‡§¨‡§¶‡§≤‡•á‡§Ç
            editIndex = -1;
            document.getElementById('saveBtn').innerText = "‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç";
            document.getElementById('formTitle').innerText = "üí∞ ‡§®‡§Ø‡§æ ‡§ñ‡§∞‡•ç‡§ö‡§æ ‡§ú‡•ã‡•ú‡•á‡§Ç";
        }
        
        localStorage.setItem('biz_india_final_v5', JSON.stringify(db));
        resetForm();
        updateDisplay();
    }

    function editEntry(index) {
        // ‡§Ö‡§∏‡§≤‡•Ä ‡§á‡§Ç‡§°‡•á‡§ï‡•ç‡§∏ ‡§¢‡•Ç‡§Ç‡§¢‡§®‡§æ ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∞‡§ø‡§µ‡§∞‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ñ‡§§‡•Ä ‡§π‡•à
        const realIndex = (db.length - 1) - index;
        const entry = db[realIndex];
        
        document.getElementById('desc').value = entry.desc;
        document.getElementById('amt').value = entry.amt;
        document.getElementById('cat').value = entry.cat;
        
        editIndex = realIndex;
        document.getElementById('saveBtn').innerText = "‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç (Update)";
        document.getElementById('formTitle').innerText = "‚úèÔ∏è ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•Å‡§ß‡§æ‡§∞‡•á‡§Ç";
        window.scrollTo(0,0); // ‡§ä‡§™‡§∞ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§Ø‡•Ç‡•õ‡§∞ ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡•á
    }

    function deleteEntry(index) {
        const realIndex = (db.length - 1) - index;
        if(confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) {
            db.splice(realIndex, 1);
            localStorage.setItem('biz_india_final_v5', JSON.stringify(db));
            updateDisplay();
        }
    }

    function updateDisplay() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        let mTotal = 0, yTotal = 0;
        const now = new Date();

        // ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä (‡§â‡§≤‡§ü‡•á ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç - ‡§≤‡•á‡§ü‡•á‡§∏‡•ç‡§ü ‡§ä‡§™‡§∞)
        db.slice().reverse().forEach((item, index) => {
            tbody.innerHTML += `<tr>
                <td>${item.desc}<br><small style="color:#888">${item.date} | ${item.cat}</small></td>
                <td>‚Çπ${item.amt.toLocaleString('en-IN')}</td>
                <td class="actions">
                    <button class="btn-edit" onclick="editEntry(${index})">Edit</button>
                    <button class="btn-delete" onclick="deleteEntry(${index})">Del</button>
                </td>
            </tr>`;

            if(item.year === now.getFullYear()) {
                yTotal += item.amt;
                if(item.month === now.getMonth()) mTotal += item.amt;
            }
        });

        document.getElementById('monthTotal').innerText = `‚Çπ${mTotal.toLocaleString('en-IN')}`;
        document.getElementById('yearTotal').innerText = `‚Çπ${yTotal.toLocaleString('en-IN')}`;
        initChart(); // ‡§ö‡§æ‡§∞‡•ç‡§ü ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂
    }

    function resetForm() {
        document.getElementById('desc').value = '';
        document.getElementById('amt').value = '';
        document.getElementById('cat').value = '';
    }

    function initChart() {
        const ctx = document.getElementById('expenseChart').getContext('2d');
        const totals = {};
        db.forEach(item => totals[item.cat] = (totals[item.cat] || 0) + item.amt);
        
        if(window.chartObj) window.chartObj.destroy();
        window.chartObj = new Chart(ctx, {
            type: 'doughnut',
            data: { labels: Object.keys(totals), datasets: [{ data: Object.values(totals), backgroundColor: ['#4285F4', '#34A853', '#FBBC05', '#EA4335', '#8E44AD'] }] },
            options: { maintainAspectRatio: false }
        });
    }

    function exportToCSV() {
        let csv = "Date,Category,Description,Amount\n";
        db.forEach(r => csv += `${r.date},${r.cat},${r.desc},${r.amt}\n`);
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'BizHisab_Data.csv';
        a.click();
    }
</script>
</body>
</html>
