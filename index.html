<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizHisab Pro - Dual Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #4285F4; --success: #34A853; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 50px; }
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 15px; }
        
        /* Dashboard Summary */
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .summary-card { padding: 12px; border-radius: 12px; text-align: center; color: white; }
        .month-card { background: #4285F4; }
        .year-card { background: #34A853; }
        .val { font-size: 1.2rem; font-weight: bold; }

        /* Two Charts Grid */
        .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .chart-box { text-align: center; }
        .chart-label { font-size: 0.75rem; font-weight: bold; margin-bottom: 5px; color: #555; }

        input, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .history-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .history-table td { padding: 8px; border-bottom: 1px solid #eee; }
        .btn-edit { color: #4285F4; background: none; border: none; font-weight: bold; font-size: 11px; }
        .btn-del { color: #EA4335; background: none; border: none; font-weight: bold; font-size: 11px; margin-left: 5px; }
    </style>
</head>
<body>

    <div class="summary-grid">
        <div class="summary-card month-card">
            <div id="mName" style="font-size: 0.7rem;">‡§Æ‡§π‡•Ä‡§®‡§æ</div>
            <div class="val" id="monthTotal">‚Çπ0</div>
        </div>
        <div class="summary-card year-card">
            <div id="yName" style="font-size: 0.7rem;">‡§∏‡§æ‡§≤</div>
            <div class="val" id="yearTotal">‚Çπ0</div>
        </div>
    </div>

    <div class="card charts-grid">
        <div class="chart-box">
            <div class="chart-label">‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡§æ ‡§ñ‡§∞‡•ç‡§ö</div>
            <canvas id="monthChart" style="height: 150px;"></canvas>
        </div>
        <div class="chart-box">
            <div class="chart-label">‡§∏‡§æ‡§≤ ‡§ï‡§æ ‡§ñ‡§∞‡•ç‡§ö</div>
            <canvas id="yearChart" style="height: 150px;"></canvas>
        </div>
    </div>

    <div class="card">
        <h3 id="formTitle" style="margin:0; font-size:1rem;">üí∞ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡§∞‡•á‡§Ç</h3>
        <input type="text" id="desc" placeholder="‡§ñ‡§∞‡•ç‡§ö‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?">
        <input type="number" id="amt" placeholder="‡§ï‡§ø‡§§‡§®‡•á ‡§∞‡•Å‡§™‡§Ø‡•á?">
        <input type="text" id="cat" placeholder="‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä" list="cat-list">
        <datalist id="cat-list"></datalist>
        <button onclick="saveData()" id="saveBtn">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <div class="card">
        <h3 style="margin:0; font-size:1rem;">üìú ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä</h3>
        <div style="overflow-x:auto;">
            <table class="history-table">
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

<script>
    let db = JSON.parse(localStorage.getItem('biz_india_v6')) || [];
    let mChart, yChart;
    let editIdx = -1;

    window.onload = () => {
        setupCharts();
        updateDisplay();
    };

    function setupCharts() {
        const mCtx = document.getElementById('monthChart').getContext('2d');
        const yCtx = document.getElementById('yearChart').getContext('2d');
        const config = { type: 'pie', data: { labels: [], datasets: [{ data: [], backgroundColor: ['#4285F4', '#34A853', '#FBBC05', '#EA4335', '#8E44AD'] }] }, options: { plugins: { legend: { display: false } }, maintainAspectRatio: false } };
        
        mChart = new Chart(mCtx, config);
        yChart = new Chart(yCtx, JSON.parse(JSON.stringify(config))); // ‡§ï‡•â‡§™‡•Ä ‡§∏‡§æ‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è
    }

    function saveData() {
        const desc = document.getElementById('desc').value;
        const amt = parseFloat(document.getElementById('amt').value);
        const cat = document.getElementById('cat').value || "Other";
        const now = new Date();

        if(!desc || isNaN(amt)) return alert("‡§µ‡§ø‡§µ‡§∞‡§£ ‡§î‡§∞ ‡§∞‡§ï‡§Æ ‡§≠‡§∞‡•á‡§Ç!");

        const entry = { date: now.toLocaleDateString('en-IN'), month: now.getMonth(), year: now.getFullYear(), desc, amt, cat };

        if(editIdx === -1) db.push(entry);
        else { db[editIdx] = entry; editIdx = -1; document.getElementById('saveBtn').innerText = "‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç"; }
        
        localStorage.setItem('biz_india_v6', JSON.stringify(db));
        resetForm();
        updateDisplay();
    }

    function updateDisplay() {
        const now = new Date();
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        
        let mTotal = 0, yTotal = 0;
        let mData = {}, yData = {};

        db.slice().reverse().forEach((item, index) => {
            const realIdx = (db.length - 1) - index;
            tbody.innerHTML += `<tr>
                <td><b>${item.desc}</b><br><small>${item.date} | ${item.cat}</small></td>
                <td style="text-align:right">‚Çπ${item.amt}<br>
                    <button class="btn-edit" onclick="edit(${realIdx})">Edit</button>
                    <button class="btn-del" onclick="del(${realIdx})">X</button>
                </td>
            </tr>`;

            // Yearly Logic
            if(item.year === now.getFullYear()) {
                yTotal += item.amt;
                yData[item.cat] = (yData[item.cat] || 0) + item.amt;
                
                // Monthly Logic
                if(item.month === now.getMonth()) {
                    mTotal += item.amt;
                    mData[item.cat] = (mData[item.cat] || 0) + item.amt;
                }
            }
        });

        // UI Labels
        const months = ["‡§ú‡§®‡§µ‡§∞‡•Ä", "‡§´‡§∞‡§µ‡§∞‡•Ä", "‡§Æ‡§æ‡§∞‡•ç‡§ö", "‡§Ö‡§™‡•ç‡§∞‡•à‡§≤", "‡§Æ‡§à", "‡§ú‡•Ç‡§®", "‡§ú‡•Å‡§≤‡§æ‡§à", "‡§Ö‡§ó‡§∏‡•ç‡§§", "‡§∏‡§ø‡§§‡§Ç‡§¨‡§∞", "‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞", "‡§®‡§µ‡§Ç‡§¨‡§∞", "‡§¶‡§ø‡§∏‡§Ç‡§¨‡§∞"];
        document.getElementById('mName').innerText = months[now.getMonth()];
        document.getElementById('yName').innerText = now.getFullYear();
        document.getElementById('monthTotal').innerText = `‚Çπ${mTotal}`;
        document.getElementById('yearTotal').innerText = `‚Çπ${yTotal}`;

        // Update Charts
        mChart.data.labels = Object.keys(mData);
        mChart.data.datasets[0].data = Object.values(mData);
        mChart.update();

        yChart.data.labels = Object.keys(yData);
        yChart.data.datasets[0].data = Object.values(yData);
        yChart.update();
    }

    function edit(idx) {
        const item = db[idx];
        document.getElementById('desc').value = item.desc;
        document.getElementById('amt').value = item.amt;
        document.getElementById('cat').value = item.cat;
        editIdx = idx;
        document.getElementById('saveBtn').innerText = "‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç";
        window.scrollTo(0,0);
    }

    function del(idx) {
        if(confirm("‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç?")) { db.splice(idx, 1); localStorage.setItem('biz_india_v6', JSON.stringify(db)); updateDisplay(); }
    }

    function resetForm() {
        document.getElementById('desc').value = '';
        document.getElementById('amt').value = '';
        document.getElementById('cat').value = '';
    }
</script>
</body>
</html>
